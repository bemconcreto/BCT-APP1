<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bem Concreto Token (BCT)</title>

    <!-- ‚ö†Ô∏è Tailwind (ok em dev) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ‚úÖ SDKs Web3Auth -->
    <script src="https://cdn.jsdelivr.net/npm/@web3auth/modal@8.12.7/dist/modal.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@web3auth/base@8.12.7/dist/base.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@web3auth/ethereum-provider@8.12.7/dist/ethereumProvider.umd.min.js"></script>

    <style>
      body {
        margin: 0;
        background-color: #121212;
        color: white;
        font-family: "Montserrat", sans-serif;
        height: 100vh;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        text-align: center;
      }

      .btn-gold {
        background: linear-gradient(145deg, #ffd700 0%, #c4a116 100%);
        color: #121212;
        font-weight: 700;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        transition: all 0.3s ease;
      }

      .btn-gold:hover {
        box-shadow: 0 6px 25px rgba(255, 215, 0, 0.5);
        transform: translateY(-2px);
      }
    </style>
  </head>

  <body>
    <h1 class="text-2xl font-bold mb-6">Bem Concreto Token (BCT)</h1>
    <div id="status" class="text-gray-300 mb-6">Aguardando autentica√ß√£o...</div>
    <button id="web3auth-button" class="btn-gold hidden">
      Entrar com Web3Auth
    </button>

    <script>
      console.log("üü¢ Iniciando front do BCT... aguardando autentica√ß√£o.");

      const statusDiv = document.getElementById("status");
      const loginButton = document.getElementById("web3auth-button");

      window.addEventListener("message", async (event) => {
        if (event.data?.type === "WEB3AUTH_READY") {
          console.log("üîµ Web3Auth sinalizado como pronto.");

          statusDiv.innerText = "Web3Auth detectado. Inicializando...";

          try {
            console.log("üü° Inicializando Web3Auth...");
            const clientId =
              "BIwYJojwNhLFJ0-IqacUDTW1U6hoGoJrEz6KdgvokTwlUGtXaT6jdtK7lik7lJVlgz6HuSRDIn5Vh-_oOyVqvaE";

            // üß© Corrigido: Objeto global com 'A' mai√∫sculo
            const { EthereumPrivateKeyProvider } = window.Web3AuthEthereumProvider;

            const privateKeyProvider = new EthereumPrivateKeyProvider({
              config: {
                chainConfig: {
                  chainNamespace: "eip155",
                  chainId: "0x89", // Polygon mainnet
                  rpcTarget: "https://polygon-rpc.com",
                },
              },
            });

            const { Web3Auth } = window.Web3AuthModal;
            const web3auth = new Web3Auth({
              clientId,
              web3AuthNetwork: "sapphire_devnet",
              privateKeyProvider,
            });

            await web3auth.initModal();
            console.log("‚úÖ Web3Auth inicializado dentro do iframe.");

            // Exibe bot√£o ap√≥s init
            loginButton.classList.remove("hidden");
            statusDiv.innerText =
              "Web3Auth pronto. Clique para entrar na sua conta.";

            loginButton.onclick = async () => {
              try {
                const provider = await web3auth.connect();
                if (provider) {
                  console.log("‚úÖ Usu√°rio autenticado com sucesso!");
                  statusDiv.innerText = "Usu√°rio autenticado!";
                  loginButton.classList.add("hidden");
                }
              } catch (loginError) {
                console.error("‚ùå Erro no login:", loginError);
                alert("Erro ao conectar. Tente novamente.");
              }
            };
          } catch (err) {
            console.error("‚ùå Erro ao inicializar Web3Auth:", err);
            statusDiv.innerText = "Erro ao inicializar autentica√ß√£o.";
          }
        }
      });
    </script>
  </body>
</html>
